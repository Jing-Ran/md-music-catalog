!function(){"use strict";function e(){let e=document.createDocumentFragment(),t=document.createElement("div"),a=t.cloneNode(),l=t.cloneNode(),n=t.cloneNode(),o=t.cloneNode();return o.setAttribute("class","album__img"),l.innerHTML='<h3 class="album__title"></h3><p class="album__artist"><i class="material-icons">account_circle</i><a target="_blank"></a></p><div class="album__intro"></div>',l.setAttribute("class","album__content"),n.innerHTML='<i class="material-icons">play_circle_filled</i><a target="_blank" class="album__url">Play album on FMA</a>',n.setAttribute("class","album__footer"),a.appendChild(o),a.appendChild(l),a.appendChild(n),a.setAttribute("class","album"),e.appendChild(a),e}function t(e){if("indexedDB"in window){console.log("createlocaldb");let e=window.indexedDB.open("albumsDB",1);e.onupgradeneeded=(e=>{let t=e.target.result;(console.log("fetchdatafromserver"),new Promise((e,t)=>{let a=new XMLHttpRequest;a.onload=(()=>{e(a.response)}),a.onerror=(e=>{t(e)}),a.open("GET","https://freemusicarchive.org/api/get/albums.json?api_key=YC599MAICF4YWNG3",!1),a.setRequestHeader("Accept","application/json"),a.send()})).then(e=>{console.log("fetch albums");let a=Array.from(JSON.parse(e).dataset);t.createObjectStore("albums",{keyPath:"album_id"}).transaction.oncomplete=(()=>{let e=t.transaction("albums","readwrite").objectStore("albums");a.forEach(t=>e.add(t))})},e=>{console.log(e)})}),e.onsuccess=a()}}function a(){if("indexedDB"in window){window.indexedDB.open("albumsDB").onsuccess=function(t){let a=t.target.result.transaction("albums","readonly").objectStore("albums").getAll();a.onsuccess=(()=>{let t=a.result,n=document.createDocumentFragment();for(let a=0;a<t.length;a++){let l=e();l.querySelector(".album__img").style.backgroundImage="url("+t[a].album_images[0].image_file+")",l.querySelector(".album__title").innerHTML=t[a].album_title,l.querySelector(".album__artist a").innerHTML=t[a].artist_name,l.querySelector(".album__artist a").setAttribute("href",t[a].artist_url),l.querySelector(".album__intro").innerHTML=t[a].album_information,l.querySelector(".album__url").setAttribute("href",t[a].album_url),n.appendChild(l)}l.appendChild(n)})}}}let l=document.querySelector(".catalog");!function(){if("indexedDB"in window){let e=window.indexedDB.open("albumsDB"),l=!0;e.onupgradeneeded=function(e){1===e.target.result.version?(e.target.transaction.abort(),l=!1):l=!0,l||t()},e.onsuccess=(e=>{l&&a()})}}()}();